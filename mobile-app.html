<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Follower Checker - Mobile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px 20px;
        }

        .tab-container {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 4px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .step {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .step h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .step p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
            font-family: monospace;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .results {
            margin-top: 20px;
            padding: 20px;
            background: #e8f5e8;
            border-radius: 12px;
            border: 1px solid #4caf50;
        }

        .results h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .stat strong {
            color: #333;
        }

        .download-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #ffcdd2;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .instructions h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .instructions ol {
            color: #856404;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .copy-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 10px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì± Instagram Follower Checker</h1>
            <p>Find who's not following you back</p>
        </div>

        <div class="content">
            <div class="tab-container">
                <div class="tab active" onclick="switchTab('manual')">Manual Input</div>
                <div class="tab" onclick="switchTab('auto')">Auto Mode</div>
            </div>

            <!-- Manual Input Tab -->
            <div id="manual-tab" class="tab-content active">
                <div class="instructions">
                    <h3>üìã How to get your data:</h3>
                    <ol>
                        <li>Go to Instagram.com in Safari</li>
                        <li>Open your profile page</li>
                        <li>Click on "followers" and copy all usernames</li>
                        <li>Click on "following" and copy all usernames</li>
                        <li>Paste them here and analyze</li>
                    </ol>
                </div>

                <div class="step">
                    <h3>üë• Step 1: Paste Your Followers</h3>
                    <p>Copy all usernames from your followers list and paste them here (one per line):</p>
                    <div class="input-group">
                        <label for="followers-input">Followers (one username per line):</label>
                        <textarea id="followers-input" placeholder="username1&#10;username2&#10;username3"></textarea>
                    </div>
                </div>

                <div class="step">
                    <h3>üë§ Step 2: Paste Your Following</h3>
                    <p>Copy all usernames from your following list and paste them here (one per line):</p>
                    <div class="input-group">
                        <label for="following-input">Following (one username per line):</label>
                        <textarea id="following-input" placeholder="username1&#10;username2&#10;username3"></textarea>
                    </div>
                </div>

                <button class="btn" onclick="analyzeData()">üîç Analyze Data</button>
            </div>

            <!-- Auto Mode Tab -->
            <div id="auto-tab" class="tab-content">
                <div class="instructions">
                    <h3>‚ö†Ô∏è Important Note:</h3>
                    <p>Due to Instagram's security policies, automatic data extraction requires:</p>
                    <ol>
                        <li>Instagram Business/Creator account</li>
                        <li>Instagram Graph API access</li>
                        <li>App review approval from Meta</li>
                    </ol>
                    <p>For now, please use the Manual Input method above.</p>
                </div>

                <div class="step">
                    <h3>üîê Instagram API Access</h3>
                    <p>To enable automatic data extraction, you would need:</p>
                    <ul style="color: #666; padding-left: 20px; margin-top: 10px;">
                        <li>Instagram Business or Creator account</li>
                        <li>Facebook Developer account</li>
                        <li>Instagram Basic Display or Graph API permissions</li>
                        <li>App review approval from Meta</li>
                    </ul>
                </div>

                <button class="btn btn-secondary" disabled>Coming Soon</button>
            </div>

            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Analyzing your Instagram data...</p>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">Processing your followers and following lists...</p>
            </div>

            <div id="results" class="results" style="display: none;">
                <h3>üìà Analysis Results</h3>
                <div class="stat">
                    <span>Total Followers:</span>
                    <strong id="followersCount">0</strong>
                </div>
                <div class="stat">
                    <span>Total Following:</span>
                    <strong id="followingCount">0</strong>
                </div>
                <div class="stat">
                    <span>Not Following Back:</span>
                    <strong id="notFollowingCount">0</strong>
                </div>
                <div class="stat">
                    <span>You're Not Following:</span>
                    <strong id="notFollowingThemCount">0</strong>
                </div>
                <div class="stat">
                    <span>Mutual Followers:</span>
                    <strong id="mutualCount">0</strong>
                </div>
                
                <button class="download-btn" onclick="downloadResults()">üì• Download CSV</button>
                <button class="copy-btn" onclick="copyResults()">üìã Copy Results</button>
            </div>

            <div id="error" class="error" style="display: none;"></div>
            <div id="success" class="success" style="display: none;"></div>
        </div>
    </div>

    <script>
        let analysisData = null;
        let sessionId = null;

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function parseUsernames(text) {
            return text.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0 && !line.startsWith('#'))
                .map(username => username.replace(/^@/, '')); // Remove @ symbols
        }

        async function analyzeData() {
            const followersText = document.getElementById('followers-input').value;
            const followingText = document.getElementById('following-input').value;

            if (!followersText.trim() || !followingText.trim()) {
                showError('Please enter both followers and following data.');
                return;
            }

            const followers = parseUsernames(followersText);
            const following = parseUsernames(followingText);

            if (followers.length === 0 || following.length === 0) {
                showError('No valid usernames found. Please check your input.');
                return;
            }

            // Show loading state
            showLoading();

            try {
                // Try to use local server if available, otherwise use client-side processing
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ followers, following })
                });

                if (response.ok) {
                    const data = await response.json();
                    analysisData = data.results;
                    sessionId = data.sessionId;
                    showResults();
                } else {
                    // Fallback to client-side processing
                    processDataLocally(followers, following);
                }
            } catch (error) {
                // Fallback to client-side processing
                processDataLocally(followers, following);
            }
        }

        function processDataLocally(followers, following) {
            // Convert to sets for efficient comparison
            const followersSet = new Set(followers.map(f => f.toLowerCase()));
            const followingSet = new Set(following.map(f => f.toLowerCase()));
            
            // Find who's not following back
            const notFollowingBack = following.filter(user => 
                !followersSet.has(user.toLowerCase())
            );

            // Find who you're not following back
            const notFollowingThem = followers.filter(user => 
                !followingSet.has(user.toLowerCase())
            );

            // Find mutual followers
            const mutual = followers.filter(user => 
                followingSet.has(user.toLowerCase())
            );

            analysisData = {
                followers: followers.length,
                following: following.length,
                notFollowingBack: notFollowingBack,
                notFollowingBackCount: notFollowingBack.length,
                notFollowingThem: notFollowingThem,
                notFollowingThemCount: notFollowingThem.length,
                mutual: mutual,
                mutualCount: mutual.length
            };

            showResults();
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('success').style.display = 'none';
        }

        function showResults() {
            document.getElementById('loading').style.display = 'none';
            
            document.getElementById('followersCount').textContent = analysisData.followers;
            document.getElementById('followingCount').textContent = analysisData.following;
            document.getElementById('notFollowingCount').textContent = analysisData.notFollowingBackCount;
            document.getElementById('notFollowingThemCount').textContent = analysisData.notFollowingThemCount;
            document.getElementById('mutualCount').textContent = analysisData.mutualCount;
            
            document.getElementById('results').style.display = 'block';
        }

        function showError(message) {
            document.getElementById('error').textContent = message;
            document.getElementById('error').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
        }

        function showSuccess(message) {
            document.getElementById('success').textContent = message;
            document.getElementById('success').style.display = 'block';
            setTimeout(() => {
                document.getElementById('success').style.display = 'none';
            }, 3000);
        }

        async function downloadResults() {
            if (!analysisData) return;

            try {
                if (sessionId) {
                    // Use server endpoint
                    window.open(`/api/download/${sessionId}`, '_blank');
                } else {
                    // Client-side download
                    const csvContent = [
                        'username,type',
                        ...analysisData.notFollowingBack.map(username => `${username},not_following_back`),
                        ...analysisData.notFollowingThem.map(username => `${username},you_not_following`),
                        ...analysisData.mutual.map(username => `${username},mutual`)
                    ].join('\n');

                    const blob = new Blob([csvContent], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'instagram_analysis.csv';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }
                
                showSuccess('Download started!');
            } catch (error) {
                showError('Download failed. Please try again.');
            }
        }

        function copyResults() {
            if (!analysisData) return;

            const summary = `Instagram Analysis Results:
            
Followers: ${analysisData.followers}
Following: ${analysisData.following}
Not Following Back: ${analysisData.notFollowingBackCount}
You're Not Following: ${analysisData.notFollowingThemCount}
Mutual Followers: ${analysisData.mutualCount}

Not Following Back (${analysisData.notFollowingBackCount}):
${analysisData.notFollowingBack.slice(0, 20).join(', ')}${analysisData.notFollowingBack.length > 20 ? '...' : ''}`;

            navigator.clipboard.writeText(summary).then(() => {
                showSuccess('Results copied to clipboard!');
            }).catch(() => {
                showError('Failed to copy results.');
            });
        }

        // Check if we're on iOS
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        if (isIOS) {
            // Add iOS-specific optimizations
            document.body.style.webkitUserSelect = 'none';
            document.body.style.webkitTouchCallout = 'none';
        }
    </script>
</body>
</html>
